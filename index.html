<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Reporter's Toolkit: Mastering Reported Speech</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;900&family=Playfair+Display:wght@700;900&family=Courier+Prime:wght@400;700&family=Fredoka+One&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#FF6B6B',
                        secondary: '#4ECDC4',
                        dark: '#2D3436',
                        light: '#F7F9FC',
                        paper: '#FDFBF7',
                        police: '#1a237e',
                        emergency: '#C51111',
                        blooket: '#0bc2cf',
                        baamboozle: '#473bf0',
                        gold: '#F59E0B'
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        serif: ['Playfair Display', 'serif'],
                        mono: ['Courier Prime', 'monospace'],
                        game: ['Fredoka One', 'cursive']
                    },
                    backgroundImage: {
                        'paper-pattern': "url('https://www.transparenttextures.com/patterns/cream-paper.png')",
                        'jail-bars': "repeating-linear-gradient(90deg, transparent, transparent 40px, rgba(0,0,0,0.1) 40px, rgba(0,0,0,0.1) 50px)"
                    },
                    animation: {
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'bounce-slight': 'bounce 2s infinite',
                    }
                }
            }
        }
    </script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f9fafb;
            color: #1f2937;
        }
        h1, h2, h3, h4 {
            font-family: 'Playfair Display', serif;
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 800px;
            margin: 0 auto;
            height: 400px;
        }
        .loader {
            width: 24px;
            height: 24px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #FF6B6B;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Smooth Accordion Transitions */
        .examples-container {
            transition: max-height 0.4s ease-in-out, opacity 0.4s ease-in-out, margin-top 0.3s ease;
            max-height: 0;
            opacity: 0;
            overflow: hidden;
        }
        .examples-container.open {
            opacity: 1;
        }
        
        /* Tab Animations */
        .tab-content {
            display: none;
            animation: fadeIn 0.4s ease-out forwards;
        }
        .tab-content.active {
            display: block;
        }
        .main-view {
            display: none;
            opacity: 0;
            transform: translateY(10px);
            transition: opacity 0.4s ease-out, transform 0.4s ease-out;
        }
        .main-view.active {
            display: block;
            opacity: 1;
            transform: translateY(0);
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(5px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Interactive Elements */
        .verb-card {
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        .verb-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1);
        }
        
        /* Detective Card Styles */
        .detective-card {
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .detective-card:hover {
            border-color: #FF6B6B;
            background-color: #FFF5F5;
        }
        .detective-card .reveal-content {
            max-height: 0;
            opacity: 0;
            overflow: hidden;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .detective-card.revealed .reveal-content {
            max-height: 200px;
            opacity: 1;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px dashed #e5e7eb;
        }
        .detective-card.revealed .question-mark {
            display: none;
        }

        /* Drill Styles */
        .drill-btn {
            transition: all 0.2s;
        }
        .drill-btn.correct {
            background-color: #10B981 !important;
            color: white !important;
            border-color: #10B981 !important;
        }
        .drill-btn.incorrect {
            background-color: #EF4444 !important;
            color: white !important;
            border-color: #EF4444 !important;
            opacity: 0.6;
        }

        /* Crime File Styles */
        .case-file {
            transition: transform 0.2s;
            cursor: pointer;
        }
        .case-file:hover {
            transform: translateY(-5px);
        }
        
        /* Voting Buttons */
        .vote-btn {
            transition: all 0.2s;
        }
        .vote-btn.sus {
            background-color: #f59e0b; /* Yellow-500 */
            border-color: #d97706;
            color: white;
        }
        .vote-btn.ejected {
            background-color: #dc2626; /* Red-600 */
            border-color: #b91c1c;
            color: white;
            text-decoration: line-through;
            opacity: 0.6;
        }
        
        /* Secret Modal */
        #role-modal, #textbook-modal {
            backdrop-filter: blur(5px);
        }

        /* Game Logo Cards */
        .game-card {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .game-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }

        /* Custom Scrollbar for tables */
        .custom-scrollbar::-webkit-scrollbar {
            height: 8px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }
        
        /* Highlight Utility for Textbook Tab */
        .highlight-word {
            background-color: #fef08a; /* yellow-200 */
            border-radius: 2px;
            padding: 0 2px;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .highlight-word:hover {
            background-color: #fde047; /* yellow-300 */
        }
        .highlight-word.selected {
            background-color: #86efac; /* green-300 */
            font-weight: bold;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <div class="container mx-auto px-4 py-8 md:px-8 max-w-7xl flex-grow">

        <header class="text-center my-8 md:my-12">
            <div class="inline-block p-2 px-4 bg-primary/10 text-primary rounded-full text-sm font-bold tracking-wide uppercase mb-4">Interactive Grammar</div>
            <h1 class="text-5xl md:text-7xl font-black text-dark mb-4 leading-tight">The Reporter's <span class="text-primary">Toolkit</span></h1>
            <p class="mt-4 text-xl text-gray-600 max-w-2xl mx-auto font-light">Master the art of Reported Speech using the dramatic conflict of "The War of the Currents" between Edison and Tesla.</p>
        </header>

        <!-- MAIN NAVIGATION TABS -->
        <nav class="flex justify-center mb-12">
            <div class="bg-white p-1 rounded-full shadow-lg border border-gray-100 flex overflow-hidden flex-wrap md:flex-nowrap">
                <button onclick="switchMainTab('revision')" id="btn-revision" class="main-tab-btn rounded-full px-6 md:px-8 py-3 text-xs md:text-base font-bold transition-all duration-300 bg-dark text-white shadow-md flex-1 md:flex-none">
                    üìö Revision Guide
                </button>
                <button onclick="switchMainTab('textbook')" id="btn-textbook" class="main-tab-btn rounded-full px-6 md:px-8 py-3 text-xs md:text-base font-bold text-gray-500 hover:text-gray-800 transition-all duration-300 flex-1 md:flex-none">
                    üìò Textbook Warm-up
                </button>
                <button onclick="switchMainTab('tools')" id="btn-tools" class="main-tab-btn rounded-full px-6 md:px-8 py-3 text-xs md:text-base font-bold text-gray-500 hover:text-gray-800 transition-all duration-300 flex-1 md:flex-none">
                    üõ†Ô∏è Practice Lab
                </button>
                <button onclick="switchMainTab('crime')" id="btn-crime" class="main-tab-btn rounded-full px-6 md:px-8 py-3 text-xs md:text-base font-bold text-gray-500 hover:text-gray-800 transition-all duration-300 flex-1 md:flex-none">
                    üïµÔ∏è Crime Roleplay
                </button>
                <button onclick="switchMainTab('games')" id="btn-games" class="main-tab-btn rounded-full px-6 md:px-8 py-3 text-xs md:text-base font-bold text-gray-500 hover:text-gray-800 transition-all duration-300 flex-1 md:flex-none">
                    üéÆ Play & Review
                </button>
            </div>
        </nav>

        <main>
            <!-- ================= VIEW 1: REVISION GUIDE ================= -->
            <div id="view-revision" class="main-view active space-y-12">
                <!-- Video: Revision Guide Intro -->
                <div class="w-full max-w-4xl mx-auto rounded-2xl overflow-hidden shadow-xl border border-gray-200 bg-black aspect-video">
                    <iframe src="https://drive.google.com/file/d/11EP22pCSPTywUa9n1PuYlKU5hF5Fy2F5/preview" width="100%" height="100%" style="border:none;"></iframe>
                </div>

                <section id="reference-guide" class="bg-white rounded-2xl shadow-xl overflow-hidden border border-gray-100">
                    <div class="bg-dark p-8 md:p-10 text-center relative overflow-hidden">
                        <div class="absolute top-0 left-0 w-full h-full opacity-10 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')]"></div>
                        <h2 class="text-3xl md:text-4xl font-bold text-white relative z-10">Master Reference Guide</h2>
                        <p class="text-gray-300 mt-2 relative z-10 text-lg">The definitive rules for transforming direct speech.</p>
                    </div>

                    <!-- Sub-Tabs Navigation -->
                    <div class="flex flex-wrap border-b border-gray-200 bg-gray-50/50">
                        <button class="sub-tab-btn flex-1 py-4 px-4 text-sm md:text-base font-bold text-dark border-b-4 border-primary bg-white transition-all duration-200" onclick="switchSubTab(this, 'tenses')">
                            ‚è≥ Tenses & Modals
                        </button>
                        <button class="sub-tab-btn flex-1 py-4 px-4 text-sm md:text-base font-bold text-gray-500 border-b-4 border-transparent hover:bg-gray-100 transition-all duration-200" onclick="switchSubTab(this, 'time')">
                            üìç Time & Place
                        </button>
                        <button class="sub-tab-btn flex-1 py-4 px-4 text-sm md:text-base font-bold text-gray-500 border-b-4 border-transparent hover:bg-gray-100 transition-all duration-200" onclick="switchSubTab(this, 'other')">
                            üë§ Imperatives & Others
                        </button>
                    </div>

                    <!-- Sub-Tabs Content -->
                    <div class="p-6 md:p-10">
                        <div id="tenses" class="tab-content active space-y-8">
                            <!-- (Existing Tenses Content) -->
                            <div class="flex items-center gap-3 mb-6">
                                <div class="w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center text-primary text-xl">1</div>
                                <h3 class="text-2xl font-bold text-gray-800">The "One Step Back" Rule (Complete List)</h3>
                            </div>
                            <div class="overflow-x-auto custom-scrollbar rounded-xl border border-gray-200 shadow-sm">
                                <table class="w-full text-left border-collapse bg-white">
                                    <thead><tr class="bg-gray-50 border-b border-gray-200"><th class="p-5 font-bold text-gray-500 uppercase text-xs tracking-wider w-1/2">Direct Speech</th><th class="p-5 font-bold text-gray-500 uppercase text-xs tracking-wider w-1/2">Reported Speech</th></tr></thead>
                                    <tbody class="divide-y divide-gray-100 text-sm md:text-base">
                                        <tr class="hover:bg-blue-50/30 transition duration-150 group">
                                            <td class="p-5 align-top"><span class="font-bold text-primary">Present Simple</span> <span class="text-xs text-gray-500 block font-mono mt-1">(S + V1/Vs)</span><br>"I <span class="font-bold">work</span> hard."</td>
                                            <td class="p-5 align-top"><span class="font-bold text-dark">Past Simple</span> <span class="text-xs text-gray-500 block font-mono mt-1">(S + V2)</span><br>He said he <span class="font-bold">worked</span> hard.</td>
                                        </tr>
                                        <tr class="hover:bg-blue-50/30 transition duration-150 group">
                                            <td class="p-5 align-top"><span class="font-bold text-primary">Present Continuous</span> <span class="text-xs text-gray-500 block font-mono mt-1">(am/is/are + V-ing)</span><br>"I <span class="font-bold">am working</span>."</td>
                                            <td class="p-5 align-top"><span class="font-bold text-dark">Past Continuous</span> <span class="text-xs text-gray-500 block font-mono mt-1">(was/were + V-ing)</span><br>He said he <span class="font-bold">was working</span>.</td>
                                        </tr>
                                        <tr class="hover:bg-blue-50/30 transition duration-150 group">
                                            <td class="p-5 align-top"><span class="font-bold text-primary">Present Perfect</span> <span class="text-xs text-gray-500 block font-mono mt-1">(have/has + V3)</span><br>"I <span class="font-bold">have finished</span>."</td>
                                            <td class="p-5 align-top"><span class="font-bold text-dark">Past Perfect</span> <span class="text-xs text-gray-500 block font-mono mt-1">(had + V3)</span><br>He said he <span class="font-bold">had finished</span>.</td>
                                        </tr>
                                        <tr class="hover:bg-blue-50/30 transition duration-150 group">
                                            <td class="p-5 align-top"><span class="font-bold text-primary">Present Perfect Cont.</span> <span class="text-xs text-gray-500 block font-mono mt-1">(have/has been + V-ing)</span><br>"I <span class="font-bold">have been waiting</span>."</td>
                                            <td class="p-5 align-top"><span class="font-bold text-dark">Past Perfect Cont.</span> <span class="text-xs text-gray-500 block font-mono mt-1">(had been + V-ing)</span><br>He said he <span class="font-bold">had been waiting</span>.</td>
                                        </tr>
                                        <tr class="hover:bg-blue-50/30 transition duration-150 group">
                                            <td class="p-5 align-top"><span class="font-bold text-primary">Past Simple</span> <span class="text-xs text-gray-500 block font-mono mt-1">(V2)</span><br>"I <span class="font-bold">bought</span> a car."</td>
                                            <td class="p-5 align-top"><span class="font-bold text-dark">Past Perfect</span> <span class="text-xs text-gray-500 block font-mono mt-1">(had + V3)</span><br>He said he <span class="font-bold">had bought</span> a car.</td>
                                        </tr>
                                        <tr class="hover:bg-blue-50/30 transition duration-150 group">
                                            <td class="p-5 align-top"><span class="font-bold text-primary">Past Continuous</span> <span class="text-xs text-gray-500 block font-mono mt-1">(was/were + V-ing)</span><br>"I <span class="font-bold">was sleeping</span>."</td>
                                            <td class="p-5 align-top"><span class="font-bold text-dark">Past Perfect Cont.</span> <span class="text-xs text-gray-500 block font-mono mt-1">(had been + V-ing)</span><br>He said he <span class="font-bold">had been sleeping</span>.</td>
                                        </tr>
                                        <tr class="hover:bg-blue-50/30 transition duration-150 group">
                                            <td class="p-5 align-top"><span class="font-bold text-primary">Past Perfect</span> <span class="text-xs text-gray-500 block font-mono mt-1">(had + V3)</span><br>"I <span class="font-bold">had done</span> it."</td>
                                            <td class="p-5 align-top"><span class="font-bold text-dark">Past Perfect</span> <span class="text-xs text-gray-500 block font-mono mt-1">(No Change)</span><br>He said he <span class="font-bold">had done</span> it.</td>
                                        </tr>
                                        <tr class="hover:bg-blue-50/30 transition duration-150 group">
                                            <td class="p-5 align-top"><span class="font-bold text-primary">Future (Will)</span> <span class="text-xs text-gray-500 block font-mono mt-1">(will + V1)</span><br>"I <span class="font-bold">will</span> call."</td>
                                            <td class="p-5 align-top"><span class="font-bold text-dark">Conditional (Would)</span> <span class="text-xs text-gray-500 block font-mono mt-1">(would + V1)</span><br>He said he <span class="font-bold">would</span> call.</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            <!-- Modals -->
                            <div class="mt-8">
                                <h3 class="text-xl font-bold text-gray-800 mb-4">üîÆ Modal Verbs Transformation</h3>
                                <div class="overflow-x-auto custom-scrollbar rounded-xl border border-gray-200 shadow-sm">
                                    <table class="w-full text-left border-collapse bg-white">
                                        <tbody class="divide-y divide-gray-100 text-sm md:text-base">
                                            <tr><td class="p-4 w-1/2">Will ‚Üí Would</td><td class="p-4 w-1/2">Can ‚Üí Could</td></tr>
                                            <tr><td class="p-4">Must ‚Üí Had to</td><td class="p-4">May ‚Üí Might</td></tr>
                                            <tr><td class="p-4">Shall ‚Üí Should</td><td class="p-4">Should ‚Üí No Change</td></tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            <!-- Exception -->
                            <div class="mt-8 bg-green-50 p-6 md:p-8 rounded-xl border-l-4 border-green-500">
                                <h5 class="font-bold text-green-800 text-xl mb-2">Exception: Present Tense Reporting Verbs</h5>
                                <p class="text-gray-700 mb-4">If the introductory word is <strong>says</strong> or <strong>tells</strong> (present tense), there is <strong>no change</strong> in the grammar tense. Note that <strong>tells</strong> is followed by an object (me, him, her).</p>
                                <div class="space-y-3">
                                    <div class="bg-white p-3 rounded-lg border border-green-100 shadow-sm">
                                        <p class="mb-0">"I <span class="font-bold text-primary">am</span> ready." ‚Üí He <strong>tells</strong> me he <span class="font-bold text-green-600">is</span> ready.</p>
                                    </div>
                                    <div class="bg-white p-3 rounded-lg border border-green-100 shadow-sm">
                                        <p class="mb-0">"I <span class="font-bold text-primary">love</span> this song." ‚Üí She <strong>says</strong> she <span class="font-bold text-green-600">loves</span> this song.</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div id="time" class="tab-content space-y-8">
                            <div class="bg-yellow-50 p-8 rounded-2xl border border-yellow-100">
                                <h4 class="font-bold text-gray-800 text-xl mb-6">‚è∞ Time Expressions</h4>
                                <ul class="space-y-2">
                                    <li>Now ‚Üí Then</li><li>Today ‚Üí That day</li><li>Tomorrow ‚Üí The next day</li><li>Yesterday ‚Üí The day before</li>
                                    <li>Tonight ‚Üí That night</li><li>Next week ‚Üí The following week</li><li>Last week ‚Üí The previous week</li>
                                    <li>Here ‚Üí There</li><li>This ‚Üí That</li><li>These ‚Üí Those</li><li>Ago ‚Üí Before</li>
                                </ul>
                            </div>
                        </div>
                        <div id="other" class="tab-content space-y-8">
                            <!-- Questions -->
                            <h4 class="font-bold text-lg mb-4 text-gray-700">‚ùì Reporting Questions</h4>
                            <div class="space-y-4 mb-8">
                                <div class="bg-gray-50 p-5 rounded-xl border border-gray-200">
                                    <p class="font-bold text-xs text-gray-500 uppercase tracking-wider mb-2">Yes/No Questions</p>
                                    <p class="mb-2 text-sm">Use <strong>if</strong> or <strong>whether</strong>.</p>
                                    <div class="space-y-2">
                                        <div class="text-sm bg-white p-2 rounded border border-gray-100">
                                            <p><span class="text-gray-400">Direct:</span> "Do you like coffee?" <span class="text-[10px] text-gray-400 border border-gray-200 rounded px-1 ml-1 uppercase">Pres. Simple</span></p>
                                            <p><span class="text-blue-600 font-bold">Reported:</span> He asked <span class="bg-yellow-100 px-1">if</span> I liked coffee.</p>
                                        </div>
                                        <div class="text-sm bg-white p-2 rounded border border-gray-100">
                                            <p><span class="text-gray-400">Direct:</span> "Have you seen the report?" <span class="text-[10px] text-gray-400 border border-gray-200 rounded px-1 ml-1 uppercase">Pres. Perfect</span></p>
                                            <p><span class="text-blue-600 font-bold">Reported:</span> She asked <span class="bg-yellow-100 px-1">if</span> I had seen the report.</p>
                                        </div>
                                        <div class="text-sm bg-white p-2 rounded border border-gray-100">
                                            <p><span class="text-gray-400">Direct:</span> "Will you come tomorrow?" <span class="text-[10px] text-gray-400 border border-gray-200 rounded px-1 ml-1 uppercase">Future</span></p>
                                            <p><span class="text-blue-600 font-bold">Reported:</span> He asked <span class="bg-yellow-100 px-1">whether</span> I would go the next day.</p>
                                        </div>
                                        <div class="text-sm bg-white p-2 rounded border border-gray-100">
                                            <p><span class="text-gray-400">Direct:</span> "Did you finish the task?" <span class="text-[10px] text-gray-400 border border-gray-200 rounded px-1 ml-1 uppercase">Past Simple</span></p>
                                            <p><span class="text-blue-600 font-bold">Reported:</span> They asked <span class="bg-yellow-100 px-1">if</span> I had finished the task.</p>
                                        </div>
                                    </div>
                                </div>

                                <div class="bg-gray-50 p-5 rounded-xl border border-gray-200">
                                    <p class="font-bold text-xs text-gray-500 uppercase tracking-wider mb-2">Wh- Questions (What, Where...)</p>
                                    <p class="mb-2 text-sm">Keep the question word.</p>
                                    <div class="space-y-2">
                                        <div class="text-sm bg-white p-2 rounded border border-gray-100">
                                            <p><span class="text-gray-400">Direct:</span> "Where do you live?" <span class="text-[10px] text-gray-400 border border-gray-200 rounded px-1 ml-1 uppercase">Pres. Simple</span></p>
                                            <p><span class="text-blue-600 font-bold">Reported:</span> He asked <span class="bg-yellow-100 px-1">where</span> I lived.</p>
                                        </div>
                                        <div class="text-sm bg-white p-2 rounded border border-gray-100">
                                            <p><span class="text-gray-400">Direct:</span> "What are you doing?" <span class="text-[10px] text-gray-400 border border-gray-200 rounded px-1 ml-1 uppercase">Pres. Cont.</span></p>
                                            <p><span class="text-blue-600 font-bold">Reported:</span> She asked <span class="bg-yellow-100 px-1">what</span> I was doing.</p>
                                        </div>
                                        <div class="text-sm bg-white p-2 rounded border border-gray-100">
                                            <p><span class="text-gray-400">Direct:</span> "When did they leave?" <span class="text-[10px] text-gray-400 border border-gray-200 rounded px-1 ml-1 uppercase">Past Simple</span></p>
                                            <p><span class="text-blue-600 font-bold">Reported:</span> He asked <span class="bg-yellow-100 px-1">when</span> they had left.</p>
                                        </div>
                                        <div class="text-sm bg-white p-2 rounded border border-gray-100">
                                            <p><span class="text-gray-400">Direct:</span> "How will we fix this?" <span class="text-[10px] text-gray-400 border border-gray-200 rounded px-1 ml-1 uppercase">Future</span></p>
                                            <p><span class="text-blue-600 font-bold">Reported:</span> They asked <span class="bg-yellow-100 px-1">how</span> we would fix that.</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Imperatives -->
                            <div class="bg-orange-50 p-6 rounded-xl border-l-4 border-orange-500">
                                <h4 class="font-bold text-orange-900 text-lg mb-4">‚òùÔ∏è Orders & Requests (Imperatives)</h4>
                                <p class="text-gray-700 mb-4 text-sm">Change the imperative verb into an <strong>Infinitive</strong> (to + verb).</p>
                                <div class="space-y-3">
                                    <div class="bg-white p-3 rounded shadow-sm border border-orange-100">
                                        <p class="text-xs text-gray-400 font-bold uppercase mb-1">Positive</p>
                                        <p class="text-sm">"Sit down." ‚ûú He told me <strong>to sit</strong> down.</p>
                                    </div>
                                    <div class="bg-white p-3 rounded shadow-sm border border-orange-100">
                                        <p class="text-xs text-gray-400 font-bold uppercase mb-1">Negative</p>
                                        <p class="text-sm">"Don't wait." ‚ûú He asked me <strong>not to wait</strong>.</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
            </div>

            <!-- ================= VIEW 0: TEXTBOOK WARM-UP (UPDATED) ================= -->
            <div id="view-textbook" class="main-view space-y-12">
                
                <section class="bg-white rounded-2xl shadow-xl overflow-hidden border border-gray-100">
                    <div class="bg-blue-600 p-8 text-center">
                        <h2 class="text-3xl font-bold text-white mb-2">The War of the Currents</h2>
                        <p class="text-blue-100">Based on Student Book Pages 40-41</p>
                    </div>
                    
                    <div class="p-8 md:p-12">
                        <div class="grid md:grid-cols-2 gap-12">
                            <!-- Text Column -->
                            <div class="space-y-6 font-serif text-lg leading-relaxed text-gray-700">
                                <h3 class="font-bold text-2xl mb-4 text-dark font-sans border-b-2 border-primary inline-block">1. Read & Discover</h3>
                                
                                <div class="w-full aspect-[4/3] rounded-lg overflow-hidden mb-6 shadow-md border border-gray-200 bg-gray-100 flex items-center justify-center relative group">
                                    <!-- Use the specific Google Drive image ID provided -->
                                    <iframe src="https://drive.google.com/file/d/10WIoYzniJic2zzVx59v7KbkGTLvrs8wU/preview" width="100%" height="100%" style="border:none;"></iframe>
                                    <button onclick="openTextbookModal()" class="absolute bottom-4 right-4 bg-white/90 text-dark px-4 py-2 rounded-full shadow-lg font-bold hover:bg-white transition opacity-0 group-hover:opacity-100 flex items-center gap-2">
                                        <span>‚õ∂</span> Focus Mode
                                    </button>
                                </div>
                                
                                <div class="bg-yellow-50 p-4 rounded-lg border-l-4 border-yellow-400 text-sm font-sans mt-4">
                                    <strong>üí° Instructions:</strong> Turn to <strong>Page 40</strong> in your book. Study the text and notice how <em>Reporting Verbs</em> (in bold) are used to report what people said without using quote marks.
                                </div>
                            </div>

                            <!-- Exercises Column -->
                            <div class="space-y-8" id="textbook-exercises-panel">
                                
                                <!-- Grammar Spot (Exercise 3 from Book) -->
                                <div class="bg-indigo-50 p-6 rounded-xl border border-indigo-200">
                                    <div class="flex justify-between items-center mb-4">
                                        <h3 class="font-bold text-xl text-indigo-900 flex items-center gap-2">
                                            <span class="bg-indigo-600 text-white w-6 h-6 rounded-full flex items-center justify-center text-sm">3</span>
                                            Grammar Spot (Page 41)
                                        </h3>
                                        <button onclick="document.getElementById('ex3-key').classList.toggle('hidden')" class="text-xs bg-indigo-200 text-indigo-800 px-2 py-1 rounded hover:bg-indigo-300 transition">Reveal Key üîë</button>
                                    </div>
                                    <p class="text-sm text-indigo-800 mb-4 font-bold">Study the reporting verbs highlighted in the article. Match them to their function:</p>
                                    
                                    <div class="space-y-4">
                                        <div class="p-3 bg-white border border-indigo-100 rounded">
                                            <p class="text-xs uppercase font-bold text-gray-500 mb-2">1. persuaded... to work / advised... to continue</p>
                                            <select class="w-full p-2 rounded text-sm border border-indigo-200 bg-gray-50 focus:outline-none focus:border-indigo-500">
                                                <option>Select pattern...</option>
                                                <option>Verb + (that) Clause</option>
                                                <option>Verb + Object + Infinitive</option>
                                                <option>Verb + Infinitive</option>
                                                <option>Verb + -ing</option>
                                            </select>
                                        </div>

                                        <div class="p-3 bg-white border border-indigo-100 rounded">
                                            <p class="text-xs uppercase font-bold text-gray-500 mb-2">2. mentioned paying...</p>
                                            <select class="w-full p-2 rounded text-sm border border-indigo-200 bg-gray-50 focus:outline-none focus:border-indigo-500">
                                                <option>Select pattern...</option>
                                                <option>Verb + (that) Clause</option>
                                                <option>Verb + Object + Infinitive</option>
                                                <option>Verb + Infinitive</option>
                                                <option>Verb + -ing</option>
                                            </select>
                                        </div>

                                        <div class="p-3 bg-white border border-indigo-100 rounded">
                                            <p class="text-xs uppercase font-bold text-gray-500 mb-2">3. asked to be paid</p>
                                            <select class="w-full p-2 rounded text-sm border border-indigo-200 bg-gray-50 focus:outline-none focus:border-indigo-500">
                                                <option>Select pattern...</option>
                                                <option>Verb + (that) Clause</option>
                                                <option>Verb + Object + Infinitive</option>
                                                <option>Verb + Infinitive</option>
                                                <option>Verb + -ing</option>
                                            </select>
                                        </div>

                                        <div class="p-3 bg-white border border-indigo-100 rounded">
                                            <p class="text-xs uppercase font-bold text-gray-500 mb-2">4. claimed that... / told him that... / announced that...</p>
                                            <select class="w-full p-2 rounded text-sm border border-indigo-200 bg-gray-50 focus:outline-none focus:border-indigo-500">
                                                <option>Select pattern...</option>
                                                <option>Verb + (that) Clause</option>
                                                <option>Verb + Object + Infinitive</option>
                                                <option>Verb + Infinitive</option>
                                                <option>Verb + -ing</option>
                                            </select>
                                        </div>
                                    </div>

                                    <!-- Answer Key Ex 3 -->
                                    <div id="ex3-key" class="hidden mt-6 p-4 bg-indigo-100 rounded text-sm text-indigo-900 border border-indigo-300 shadow-inner">
                                        <p class="font-bold mb-2 border-b border-indigo-300 pb-1">Answer Key:</p>
                                        <ul class="space-y-1">
                                            <li>1. Verb + Object + Infinitive</li>
                                            <li>2. Verb + -ing (Gerund)</li>
                                            <li>3. Verb + Infinitive</li>
                                            <li>4. Verb + (that) Clause</li>
                                        </ul>
                                    </div>
                                </div>

                                <!-- Practice (Exercise 4 from Book) -->
                                <div class="bg-orange-50 p-6 rounded-xl border border-orange-200">
                                    <div class="flex justify-between items-center mb-4">
                                        <h3 class="font-bold text-xl text-orange-900 flex items-center gap-2">
                                            <span class="bg-orange-600 text-white w-6 h-6 rounded-full flex items-center justify-center text-sm">4</span>
                                            Practice (Page 41)
                                        </h3>
                                        <button onclick="document.getElementById('ex4-key').classList.toggle('hidden')" class="text-xs bg-orange-200 text-orange-800 px-2 py-1 rounded hover:bg-orange-300 transition">Reveal Key üîë</button>
                                    </div>
                                    <p class="text-sm text-orange-800 mb-4">Report the following statements.</p>
                                    
                                    <div class="space-y-4">
                                        <!-- 1 -->
                                        <div class="bg-white p-3 rounded border border-orange-100 text-sm">
                                            <p class="italic text-gray-500 mb-1">1. "I've opened a new power station."</p>
                                            <p class="font-bold text-dark mb-1">Edison mentioned...</p>
                                            <input type="text" class="w-full p-2 border border-gray-300 rounded focus:border-orange-500 focus:outline-none" placeholder="opening a new power station">
                                        </div>
                                        <!-- 2 -->
                                        <div class="bg-white p-3 rounded border border-orange-100 text-sm">
                                            <p class="italic text-gray-500 mb-1">2. "You should try using light bulbs."</p>
                                            <p class="font-bold text-dark mb-1">Edison persuaded...</p>
                                            <input type="text" class="w-full p-2 border border-gray-300 rounded focus:border-orange-500 focus:outline-none" placeholder="everyone to try using light bulbs">
                                        </div>
                                        <!-- 3 -->
                                        <div class="bg-white p-3 rounded border border-orange-100 text-sm">
                                            <p class="italic text-gray-500 mb-1">3. "You've worked so hard this month, Tesla!"</p>
                                            <p class="font-bold text-dark mb-1">Tesla's co-workers praised...</p>
                                            <input type="text" class="w-full p-2 border border-gray-300 rounded focus:border-orange-500 focus:outline-none" placeholder="Tesla for working so hard">
                                        </div>

                                        <!-- 4 -->
                                        <div class="bg-white p-3 rounded border border-orange-100 text-sm">
                                            <p class="italic text-gray-500 mb-1">4. "No, I won't pay you $50,000, Tesla."</p>
                                            <p class="font-bold text-dark mb-1">Tesla's manager refused...</p>
                                            <input type="text" class="w-full p-2 border border-gray-300 rounded focus:border-orange-500 focus:outline-none" placeholder="to pay Tesla $50,000">
                                        </div>

                                        <!-- 5 -->
                                        <div class="bg-white p-3 rounded border border-orange-100 text-sm">
                                            <p class="italic text-gray-500 mb-1">5. "You shouldn't listen to Edison's warnings, everyone."</p>
                                            <p class="font-bold text-dark mb-1">Tesla advised...</p>
                                            <input type="text" class="w-full p-2 border border-gray-300 rounded focus:border-orange-500 focus:outline-none" placeholder="everyone not to listen to Edison's warnings">
                                        </div>

                                        <!-- 6 -->
                                        <div class="bg-white p-3 rounded border border-orange-100 text-sm">
                                            <p class="italic text-gray-500 mb-1">6. "Could you please give me your views on Mr. Edison's achievements, Mr. Tesla?"</p>
                                            <p class="font-bold text-dark mb-1">The newspaper reporter asked...</p>
                                            <input type="text" class="w-full p-2 border border-gray-300 rounded focus:border-orange-500 focus:outline-none" placeholder="Tesla to give his views on...">
                                        </div>
                                    </div>

                                    <!-- Answer Key Ex 4 -->
                                    <div id="ex4-key" class="hidden mt-6 p-4 bg-orange-100 rounded text-sm text-orange-900 border border-orange-300 shadow-inner">
                                        <p class="font-bold mb-2 border-b border-orange-300 pb-1">Answer Key:</p>
                                        <ul class="space-y-1 list-decimal list-inside">
                                            <li>...opening a new power station.</li>
                                            <li>...everyone to try using light bulbs.</li>
                                            <li>...Tesla for working so hard.</li>
                                            <li>...to pay Tesla $50,000.</li>
                                            <li>...everyone not to listen to Edison's warnings.</li>
                                            <li>...Tesla to give his views on Mr. Edison's achievements.</li>
                                        </ul>
                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-gray-100 p-4 text-center border-t border-gray-200">
                        <button onclick="switchMainTab('tools')" class="text-blue-600 font-bold hover:underline">Finished? Go to the Practice Lab ‚ûú</button>
                    </div>
                </section>
                
                <!-- NEW: Focus Mode Modal -->
                <div id="textbook-modal" class="fixed inset-0 z-50 hidden flex flex-col bg-white">
                    <div class="flex justify-between items-center p-4 bg-dark text-white shadow-md z-10">
                        <h2 class="text-xl font-bold font-mono">üîç Focus Mode: War of the Currents</h2>
                        <button onclick="closeTextbookModal()" class="text-2xl hover:text-red-400">&times;</button>
                    </div>
                    <div class="flex-grow flex flex-col lg:flex-row h-full overflow-hidden">
                        <!-- Left: Large Image -->
                        <div class="lg:w-7/12 h-1/2 lg:h-full bg-gray-900 p-4 flex items-center justify-center">
                            <iframe src="https://drive.google.com/file/d/10WIoYzniJic2zzVx59v7KbkGTLvrs8wU/preview" width="100%" height="100%" style="border:none;" class="rounded-lg shadow-2xl bg-white"></iframe>
                        </div>
                        <!-- Right: Scrollable Exercises -->
                        <div class="lg:w-5/12 h-1/2 lg:h-full overflow-y-auto p-6 bg-gray-50 border-l border-gray-200">
                            <div id="modal-exercises-container">
                                <!-- JS will clone exercises here -->
                            </div>
                        </div>
                    </div>
                </div>

            </div>

            <!-- ================= VIEW 2: REPORTING TOOLS ================= -->
            <div id="view-tools" class="main-view space-y-16">
                <!-- (Existing Tools Content Preserved) -->
                <section id="reporting-verbs">
                    <!-- Video: Reporting Verbs Intro -->
                    <div class="w-full max-w-4xl mx-auto mb-10 rounded-2xl overflow-hidden shadow-xl border border-gray-200 bg-black aspect-video">
                        <iframe src="https://drive.google.com/file/d/177Kow9PD7v_Ugpuacl4LWAu0oMvbuxWk/preview" width="100%" height="100%" style="border:none;"></iframe>
                    </div>
                    <div class="text-center mb-10">
                        <h2 class="text-3xl font-bold text-dark mb-4">The Reporter's Dictionary</h2>
                    </div>
                    <div id="verb-groups-container" class="space-y-12"></div>
                </section>
                <section id="verb-detective">
                    <div class="text-center mb-10"><h2 class="text-3xl font-bold text-dark mb-4">Verb Detective üïµÔ∏è</h2></div>
                    <div id="detective-container" class="grid grid-cols-1 md:grid-cols-2 gap-6 max-w-5xl mx-auto"></div>
                </section>
                <section id="training-camp">
                    <div class="text-center mb-10"><h2 class="text-3xl font-bold text-dark mb-4">Reporter's Training Camp üèãÔ∏è</h2></div>
                    <div class="grid md:grid-cols-2 gap-8">
                        <div class="bg-white rounded-2xl shadow-lg border border-gray-100 p-6">
                            <h3 class="text-xl font-bold mb-4">üìù Drill 1: The Pattern Master</h3>
                            <div id="quiz-container" class="space-y-6"></div>
                            <button onclick="loadNewQuizQuestion()" class="mt-6 w-full py-2 bg-indigo-50 text-indigo-600 font-bold rounded-lg hover:bg-indigo-100 transition">Next Question ‚ûú</button>
                        </div>
                        <div class="bg-white rounded-2xl shadow-lg border border-gray-100 p-6">
                            <h3 class="text-xl font-bold mb-4">üß© Drill 2: The Preposition Puzzle</h3>
                            <div id="prep-drill-container" class="text-center space-y-4">
                                <div id="prep-question" class="text-3xl font-bold text-dark py-4"></div>
                                <div class="grid grid-cols-2 gap-3 w-full" id="prep-options"></div>
                                <div id="prep-feedback" class="h-6 text-sm font-bold"></div>
                            </div>
                        </div>
                    </div>
                </section>
                <section id="practice-zone">
                    <div class="bg-white rounded-2xl shadow-xl overflow-hidden border-2 border-dark/10">
                        <div class="bg-dark p-8 text-center">
                            <h2 class="text-3xl font-bold text-white mb-2">The Reporting Simulator ü§ñ</h2>
                            <p class="text-gray-400">Offline Mode</p>
                        </div>
                        <div class="p-8">
                            <div class="text-center mb-8">
                                <button id="generate-scenario-btn" class="bg-primary text-white font-bold py-4 px-8 rounded-full shadow-lg hover:bg-red-500 transition transform hover:scale-105">
                                    üé≤ Generate Scenario
                                </button>
                            </div>
                            
                            <div id="scenario-box" class="max-w-3xl mx-auto bg-gray-50 rounded-2xl p-6 hidden transition-all duration-300">
                                <p id="scenario-text" class="text-lg font-medium text-gray-600 mb-2"></p>
                                
                                <!-- The Quote Card -->
                                <div class="bg-white p-6 rounded-xl border-l-4 border-primary shadow-sm mb-6">
                                    <p class="text-xs font-bold text-gray-400 uppercase tracking-widest mb-2">Direct Speech</p>
                                    <p id="direct-quote-text" class="font-serif text-2xl italic text-dark"></p>
                                    <p id="speaker-text" class="text-right text-sm text-gray-500 mt-2 font-bold"></p>
                                </div>

                                <!-- Input Area -->
                                <div class="space-y-4">
                                    <label class="block text-sm font-bold text-gray-700">Your Reported Sentence:</label>
                                    <textarea id="user-input" class="w-full p-4 border-2 border-gray-200 rounded-xl focus:border-primary focus:ring-0 transition" rows="2" placeholder="He said that..."></textarea>
                                    
                                    <button id="check-sentence-btn" class="w-full bg-dark text-white font-bold py-3 px-6 rounded-xl hover:bg-gray-800 transition">
                                        ‚ú® Check Answer
                                    </button>
                                </div>

                                <!-- Feedback Area -->
                                <div id="feedback-box" class="mt-6 hidden bg-white p-6 rounded-xl border border-gray-200 shadow-inner">
                                    <h4 id="verdict-title" class="text-xl font-bold mb-2"></h4>
                                    <p id="feedback-text" class="text-gray-700 mb-4"></p>
                                    <div class="bg-green-50 p-3 rounded-lg border border-green-200">
                                        <p class="text-xs font-bold text-green-700 uppercase mb-1">Correct Answer:</p>
                                        <p id="correct-answer-text" class="font-medium text-dark"></p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Textbook Instruction Section -->
                    <div class="mt-12 bg-white p-8 rounded-2xl shadow-lg border-l-8 border-blue-600 flex items-center gap-6">
                        <div class="text-5xl">üìò</div>
                        <div>
                            <h3 class="text-2xl font-bold text-dark mb-2">Next In-Class Activity</h3>
                            <p class="text-lg text-gray-700">
                                Please open your <strong>Discover Student Book</strong> to <strong>Page 118</strong>. 
                                <br>Complete <strong>Exercise 1</strong> now to practice the reporting verbs.
                            </p>
                        </div>
                    </div>
                </section>
            </div>

            <!-- ================= VIEW 3: CRIME ROLEPLAY (UPDATED - DIAMOND HEIST) ================= -->
            <div id="view-crime" class="main-view space-y-16">
                
                <!-- Hero Section (ATMOSPHERE UPDATE) -->
                <div class="bg-police text-white rounded-2xl shadow-2xl overflow-hidden bg-jail-bars relative">
                    <div class="absolute inset-0 bg-black/80"></div>
                    <div class="relative z-10 p-10 md:p-16 text-center">
                        <div class="inline-block bg-red-600 text-white text-xs font-bold px-3 py-1 rounded-full uppercase tracking-widest mb-4 animate-pulse">Case #5501: Active Investigation</div>
                        <h2 class="text-4xl md:text-6xl font-black font-serif mb-6 text-transparent bg-clip-text bg-gradient-to-r from-blue-200 to-white drop-shadow-lg">The Diamond Heist üíé</h2>
                        
                        <div class="max-w-4xl mx-auto space-y-6 text-lg md:text-xl text-gray-300 leading-relaxed font-light">
                            <p class="italic font-serif text-2xl text-blue-200">"The storm raged outside, masking the sound of the breaking lock..."</p>
                            
                            <p>
                                It is a dark and rainy night at Blackwood Manor. At exactly <strong>9:00 PM</strong>, the alarm shattered the silence. The legendary "Star of the East" diamond has vanished from the library.
                            </p>
                            
                            <div class="bg-white/10 p-6 rounded-xl border border-white/20 backdrop-blur-sm text-left mx-auto max-w-2xl">
                                <h4 class="text-xs font-bold uppercase tracking-widest text-blue-300 mb-2">Initial Scene Report:</h4>
                                <ul class="space-y-2 list-disc list-inside text-gray-200 text-base">
                                    <li>The storm outside has turned the garden into a mud bath.</li>
                                    <li>The glass case was lifted, yet no fingerprints were left behind.</li>
                                    <li>The theft occurred precisely when the clock struck <strong>9:00 PM</strong>.</li>
                                </ul>
                            </div>

                            <p class="font-medium text-white mt-6">
                                <span class="text-red-400 font-bold">THE MISSION:</span> Among you are <strong>TWO criminals</strong> working together. Interview the guests. Find the two suspects whose stories reveal they were in the garden or covered their tracks.
                            </p>
                        </div>
                    </div>
                </div>

                <!-- Training Module: Interrogation Sample (UPDATED) -->
                <section class="max-w-5xl mx-auto bg-gray-50 border-l-8 border-police p-8 rounded-r-xl shadow-md">
                    <h3 class="text-2xl font-bold text-dark mb-6">üéì Training Module: How to Report Crimes</h3>
                    <p class="text-gray-600 mb-6">Use these patterns to catch the liars!</p>
                    
                    <div class="space-y-4">
                        <!-- Dialogue Step 1: Interview Phase -->
                        <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200">
                            <h4 class="font-bold text-blue-600 mb-2 uppercase text-sm">Phase 1: The Interview</h4>
                            <div class="space-y-2">
                                <p><span class="font-bold">Interviewer:</span> "Where were you at 9:00 PM?"</p>
                                <p><span class="font-bold">Suspect:</span> "I was in the kitchen baking a cake."</p>
                            </div>
                        </div>

                        <!-- Dialogue Step 2: Meeting Phase (Specific Sample requested) -->
                        <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200">
                            <h4 class="font-bold text-green-600 mb-2 uppercase text-sm">Phase 2: The Meeting (Sample Argument)</h4>
                            <div class="space-y-3">
                                <p class="italic text-gray-500 text-sm border-b pb-2 mb-2">Example from a previous case:</p>
                                <p>
                                    <span class="font-bold">Detective A:</span> 
                                    "I think Suspect 7 is the criminal because <strong>he denied being near the vault</strong>, but the evidence shows footprints there."
                                </p>
                                <p>
                                    <span class="font-bold">Detective B:</span> 
                                    "I agree. Also, Suspect 6 cannot be the criminal because <strong>she mentioned playing the piano</strong> in the main hall at that exact time."
                                </p>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Mission Briefing -->
                <section class="max-w-5xl mx-auto">
                    <!-- Teacher's Note for Class Size -->
                    <div class="bg-blue-50 border-l-4 border-blue-500 p-6 mb-8 rounded-r shadow-sm">
                        <div class="flex items-start gap-4">
                            <span class="text-3xl">üë®‚Äçüè´</span>
                            <div>
                                <h4 class="font-bold text-blue-900 text-lg uppercase tracking-wide mb-2">Classroom Mission Briefing</h4>
                                <p class="text-blue-800 text-base mb-2">
                                    <strong>Team Setup:</strong> Since we have 22-23 students, we will split into <strong>TWO separate investigation groups</strong> (Group A and Group B).
                                </p>
                                <p class="text-blue-800 text-base">
                                    <strong>Crucial Rule:</strong> You must <strong>REPEAT</strong> the interview cycle with every suspect in your group. Take notes of exactly what <strong>at least 3 people</strong> said so you can report it accurately in Phase 2.
                                </p>
                            </div>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                        <div class="bg-white p-6 rounded-2xl shadow-lg border-t-4 border-primary">
                            <h3 class="font-bold text-dark mb-2">1. The Mingle</h3>
                            <p class="text-sm text-gray-600">Walk around. Ask: <em>"Where were you at 9 PM?"</em> and <em>"What were you wearing?"</em></p>
                        </div>
                        <div class="bg-white p-6 rounded-2xl shadow-lg border-t-4 border-yellow-500">
                            <h3 class="font-bold text-dark mb-2">2. The Evidence</h3>
                            <p class="text-sm text-gray-600"><strong>STOP!</strong> Reveal the Police Evidence below to see the clues about the thief.</p>
                        </div>
                        <div class="bg-white p-6 rounded-2xl shadow-lg border-t-4 border-emergency">
                            <h3 class="font-bold text-emergency mb-2">3. The Meeting</h3>
                            <p class="text-sm text-gray-600">Report findings using verbs like <em>denied, admitted, claimed</em>. Identify the contradictory stories.</p>
                        </div>
                        <div class="bg-white p-6 rounded-2xl shadow-lg border-t-4 border-secondary">
                            <h3 class="font-bold text-dark mb-2">4. The Vote</h3>
                            <p class="text-sm text-gray-600">Decide who the <strong>TWO</strong> criminals are based on the evidence.</p>
                        </div>
                    </div>
                </section>

                <!-- Secret Evidence File (Moved UP for Phase 2) -->
                <section class="max-w-4xl mx-auto mt-16 mb-10">
                    <button onclick="document.getElementById('evidence-content').classList.toggle('hidden')" class="w-full bg-gray-900 text-white font-mono text-xl py-6 rounded-2xl border-4 border-dashed border-gray-700 hover:bg-black transition flex items-center justify-center gap-4 group">
                        <span class="text-4xl group-hover:scale-110 transition">üìÇ</span>
                        <span>CLICK TO OPEN POLICE EVIDENCE (Phase 2)</span>
                    </button>
                    <div id="evidence-content" class="hidden mt-6 bg-black/90 p-8 rounded-2xl border border-gray-800 text-green-500 font-mono text-lg space-y-4 shadow-2xl">
                        <h4 class="text-white border-b border-gray-700 pb-2 mb-4">EVIDENCE REPORT #5501</h4>
                        <p>> FACT 1: The thief entered through the <strong>GARDEN WINDOW</strong> (Muddy footprints were found).</p>
                        <p>> FACT 2: The thief wore <strong>LEATHER GLOVES</strong> (No fingerprints were found on the glass case).</p>
                        <p>> FACT 3: The theft happened at exactly <strong>9:00 PM</strong>.</p>
                        <p class="pt-6 text-gray-400 italic">// INSTRUCTION: Find the two suspects who admit to being in the garden or wearing gloves.</p>
                    </div>
                </section>

                <!-- Suspect Files List (Spoiler-Proof) -->
                <section class="max-w-6xl mx-auto">
                    <h3 class="text-3xl font-bold text-center text-dark mb-10">Confidential Case Files</h3>
                    <p class="text-center text-gray-500 mb-8">Click ONLY your assigned number.</p>
                    <div id="suspects-list" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-4">
                        <!-- Generic File Buttons injected via JS -->
                    </div>
                </section>

                <!-- EMERGENCY MEETING / VOTING BOARD -->
                <section class="max-w-5xl mx-auto bg-gray-900 rounded-3xl p-8 border-4 border-emergency shadow-2xl relative overflow-hidden mt-16">
                    <div class="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/carbon-fibre.png')] opacity-20"></div>
                    
                    <div class="relative z-10">
                        <div class="flex items-center justify-between border-b border-gray-700 pb-6 mb-8">
                            <h2 class="text-3xl md:text-4xl font-black text-white uppercase tracking-widest font-mono">üö® Emergency Meeting</h2>
                            <div class="bg-red-600 text-white px-4 py-2 rounded font-bold animate-pulse">VOTING IN PROGRESS</div>
                        </div>

                        <p class="text-gray-400 mb-6 text-center">Click a suspect to toggle status: <span class="text-white">Normal</span> ‚ûú <span class="text-yellow-500">Suspicious</span> ‚ûú <span class="text-red-500 line-through">Ejected</span></p>

                        <div id="voting-grid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4">
                            <!-- Voting Buttons injected by JS -->
                        </div>
                    </div>
                </section>

                <!-- Role Modal -->
                <div id="role-modal" class="fixed inset-0 z-50 hidden flex items-center justify-center bg-black/80">
                    <div class="bg-white rounded-2xl max-w-md w-full mx-4 overflow-hidden shadow-2xl transform transition-all scale-100">
                        <div class="bg-police p-6 text-white flex justify-between items-center">
                            <h3 class="text-xl font-mono font-bold tracking-widest uppercase">Top Secret</h3>
                            <button onclick="closeRoleModal()" class="text-white hover:text-red-300 text-2xl">&times;</button>
                        </div>
                        <div class="p-8 text-center" id="modal-content">
                            <!-- Injected Content -->
                        </div>
                        <div class="bg-gray-100 p-4 text-center">
                            <button onclick="closeRoleModal()" class="bg-gray-800 text-white px-6 py-2 rounded-lg font-bold hover:bg-black transition">Close File</button>
                        </div>
                    </div>
                </div>

            </div>

            <!-- ================= VIEW 4: PLAY & REVIEW (NEW) ================= -->
            <div id="view-games" class="main-view space-y-16">
                
                <section class="bg-white rounded-2xl shadow-xl overflow-hidden border border-gray-100">
                    <div class="bg-dark p-8 md:p-10 text-center relative overflow-hidden">
                        <div class="absolute top-0 left-0 w-full h-full opacity-10 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')]"></div>
                        <h2 class="text-3xl md:text-4xl font-bold text-white relative z-10 font-game tracking-widest">GAME ZONE</h2>
                        <p class="text-gray-300 mt-2 relative z-10 text-lg">Challenge your friends and master Reported Speech!</p>
                    </div>

                    <div class="p-12 md:p-20">
                        <div class="grid md:grid-cols-3 gap-8 max-w-7xl mx-auto">
                            
                            <!-- Blooket Card (Standard) -->
                            <a href="https://dashboard.blooket.com/set/64c1cf71bf8790956346f9cb" target="_blank" class="game-card block bg-white rounded-3xl overflow-hidden shadow-xl border-4 border-transparent hover:border-blooket transition group">
                                <div class="bg-blooket h-40 flex items-center justify-center relative overflow-hidden">
                                    <!-- Blooket Logo Placeholder -->
                                    <div class="text-white font-black text-4xl font-game tracking-wider drop-shadow-md group-hover:scale-110 transition duration-300">
                                        Blooket
                                    </div>
                                    <!-- Decorative shapes mimicking Blooket style -->
                                    <div class="absolute top-4 left-4 w-8 h-8 bg-white/20 rounded-md rotate-12"></div>
                                    <div class="absolute bottom-4 right-4 w-12 h-12 bg-white/20 rounded-full"></div>
                                </div>
                                <div class="p-6 text-center">
                                    <h3 class="text-xl font-bold text-dark mb-2">Standard Review</h3>
                                    <p class="text-gray-500 text-sm mb-4">Fast-paced grammar games.</p>
                                    <span class="inline-block bg-blooket text-white font-bold py-2 px-6 rounded-full text-sm shadow-md group-hover:shadow-blooket/50 transition">
                                        PLAY ‚ñ∂
                                    </span>
                                </div>
                            </a>

                            <!-- Baamboozle Card (Standard) -->
                            <a href="https://www.baamboozle.com/game/48871" target="_blank" class="game-card block bg-white rounded-3xl overflow-hidden shadow-xl border-4 border-transparent hover:border-baamboozle transition group">
                                <div class="bg-baamboozle h-40 flex items-center justify-center relative overflow-hidden">
                                    <!-- Baamboozle Logo Placeholder (Text-based for reliability) -->
                                    <div class="text-white font-black text-4xl font-sans tracking-tight drop-shadow-md group-hover:scale-110 transition duration-300">
                                        Baamboozle
                                    </div>
                                    <div class="absolute top-0 left-0 w-full h-full bg-white opacity-10 rotate-12 transform scale-150"></div>
                                </div>
                                <div class="p-6 text-center">
                                    <h3 class="text-xl font-bold text-dark mb-2">Team Battle</h3>
                                    <p class="text-gray-500 text-sm mb-4">Standard team trivia.</p>
                                    <span class="inline-block bg-baamboozle text-white font-bold py-2 px-6 rounded-full text-sm shadow-md group-hover:shadow-baamboozle/50 transition">
                                        PLAY ‚ñ∂
                                    </span>
                                </div>
                            </a>

                            <!-- Baamboozle Card (Expert) -->
                            <a href="https://www.baamboozle.com/game/1591888" target="_blank" class="game-card block bg-white rounded-3xl overflow-hidden shadow-xl border-4 border-transparent hover:border-gold transition group relative">
                                <div class="absolute top-3 right-3 bg-gold text-white text-[10px] font-bold px-2 py-1 rounded-full uppercase tracking-wider shadow-md z-10 animate-pulse-slow">
                                    üî• Expert
                                </div>
                                <div class="bg-gray-800 h-40 flex items-center justify-center relative overflow-hidden">
                                    <!-- Baamboozle Logo Placeholder (Text-based for reliability) -->
                                    <div class="text-gold font-black text-4xl font-sans tracking-tight drop-shadow-md group-hover:scale-110 transition duration-300">
                                        Hard Mode
                                    </div>
                                    <div class="absolute top-0 left-0 w-full h-full bg-white opacity-5 rotate-12 transform scale-150"></div>
                                </div>
                                <div class="p-6 text-center">
                                    <h3 class="text-xl font-bold text-dark mb-2">Extra Challenge</h3>
                                    <p class="text-gray-500 text-sm mb-4">Advanced questions only!</p>
                                    <span class="inline-block bg-gold text-white font-bold py-2 px-6 rounded-full text-sm shadow-md group-hover:shadow-gold/50 transition">
                                        PLAY ‚ñ∂
                                    </span>
                                </div>
                            </a>

                        </div>
                    </div>
                </section>

            </div>

        </main>
        
        <footer class="mt-auto py-12 text-center text-gray-400 text-sm">
            <p>¬© 2025 The Reporter's Toolkit. Built with Tailwind.</p>
        </footer>

    </div>

    <script>
        // --- Tab Logic ---
        function switchMainTab(viewName) {
            document.querySelectorAll('.main-view').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.main-tab-btn').forEach(el => {
                el.classList.remove('bg-dark', 'text-white', 'shadow-md');
                el.classList.add('text-gray-500');
            });
            document.getElementById('view-' + viewName).classList.add('active');
            const activeBtn = document.getElementById('btn-' + viewName);
            activeBtn.classList.remove('text-gray-500');
            activeBtn.classList.add('bg-dark', 'text-white', 'shadow-md');
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function switchSubTab(btn, tabId) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.sub-tab-btn').forEach(el => {
                el.classList.remove('text-dark', 'border-primary', 'bg-white');
                el.classList.add('text-gray-500', 'border-transparent');
            });
            document.getElementById(tabId).classList.add('active');
            btn.classList.remove('text-gray-500', 'border-transparent');
            btn.classList.add('text-dark', 'border-primary', 'bg-white');
        }

        // --- Data: Offline Scenario Bank (Replaces API) ---
        const offlineScenarios = [
            { quote: "I will pay you $50,000 for the work.", speaker: "Edison", verb: "promised", answer: "Edison promised to pay $50,000 for the work." },
            { quote: "AC power is dangerous.", speaker: "Edison", verb: "warned", answer: "Edison warned that AC power was dangerous." },
            { quote: "No, I won't accept the Nobel Prize.", speaker: "Tesla", verb: "refused", answer: "Tesla refused to accept the Nobel Prize." },
            { quote: "Yes, I think we should use waterfalls.", speaker: "Tesla", verb: "agreed", answer: "Tesla agreed to use waterfalls." },
            { quote: "I didn't steal the patent!", speaker: "The employee", verb: "denied", answer: "The employee denied stealing the patent." },
            { quote: "Why don't we test the motor tomorrow?", speaker: "Tesla", verb: "suggested", answer: "Tesla suggested testing the motor the next day." },
            { quote: "I'm sorry I was late to the lab.", speaker: "The assistant", verb: "apologized", answer: "The assistant apologized for being late to the lab." },
            { quote: "You really must try this new bulb.", speaker: "Edison", verb: "insisted", answer: "Edison insisted on trying the new bulb." },
            { quote: "Don't forget to lock the lab door.", speaker: "The manager", verb: "reminded", answer: "The manager reminded him to lock the lab door." },
            { quote: "Go ahead, file the patent.", speaker: "The investor", verb: "encouraged", answer: "The investor encouraged him to file the patent." }
        ];

        let currentScenario = null;

        // --- Helper Functions ---
        function createVerbCard(item) {
            const card = document.createElement('div');
            card.className = 'verb-card bg-white rounded-xl shadow-sm border border-gray-100 p-6 flex flex-col h-full';
            card.innerHTML = `
                <div class="flex justify-between items-start mb-3">
                    <h3 class="text-2xl font-bold capitalize text-dark">${item.verb}</h3>
                    <span class="px-2 py-1 bg-gray-100 text-gray-600 text-xs font-bold rounded-md uppercase tracking-wide">${item.func}</span>
                </div>
                <div class="space-y-4 mt-2">
                    <div class="bg-indigo-50/50 p-3 rounded-lg border border-indigo-100">
                        <div class="text-xs font-bold text-indigo-400 uppercase tracking-wide mb-1">Rule: ${item.rules.pattern}</div>
                        <p class="text-sm text-gray-700 italic leading-relaxed">${item.rules.example.replace(/\*\*(.*?)\*\*/g, '<strong class="text-indigo-600">$1</strong>')}</p>
                    </div>
                    <div class="bg-orange-50/50 p-3 rounded-lg border border-orange-100">
                        <div class="text-xs font-bold text-orange-400 uppercase tracking-wide mb-1">That-Clause</div>
                        <p class="text-sm text-gray-700 italic leading-relaxed">${item.rules.thatExample.replace(/\*\*(.*?)\*\*/g, '<strong class="text-orange-600">$1</strong>')}</p>
                    </div>
                </div>`;
            return card;
        }

        function createDetectiveCard(item) {
            const card = document.createElement('div');
            card.className = 'detective-card bg-white rounded-xl border border-gray-200 p-6 shadow-sm hover:shadow-md relative overflow-hidden group';
            card.onclick = function() { if (!this.classList.contains('revealed')) this.classList.add('revealed'); };
            card.innerHTML = `
                <div class="absolute top-0 right-0 p-4 opacity-10 group-hover:opacity-20 transition-opacity"><span class="text-6xl">üïµÔ∏è</span></div>
                <div class="mb-4"><div class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-2">Direct Quote</div><p class="font-serif italic text-xl text-gray-800 leading-relaxed">"${item.quote}"</p></div>
                <div class="question-mark text-center py-4"><p class="text-sm font-bold text-primary animate-pulse">Click to Reveal Intention</p></div>
                <div class="reveal-content"><div class="flex items-center gap-2 mb-2"><span class="text-sm font-bold text-gray-500 uppercase">Intention:</span><span class="px-2 py-1 bg-green-100 text-green-700 text-xs font-bold rounded uppercase">${item.intention}</span></div><div class="bg-gray-50 p-3 rounded-lg border border-gray-100"><p class="text-gray-800">${item.reported.replace(/\*\*(.*?)\*\*/g, '<strong class="text-primary">$1</strong>')}</p></div></div>`;
            return card;
        }

        function createSuspectFile(role) {
            const btn = document.createElement('div');
            btn.className = 'case-file bg-white border border-gray-200 p-4 rounded-xl shadow-sm hover:shadow-md text-center group flex flex-col items-center justify-center h-40';
            btn.onclick = () => openRoleModal(role);
            btn.innerHTML = `
                <span class="text-5xl mb-2 group-hover:scale-110 transition-transform">üìÇ</span>
                <span class="font-bold text-gray-700">CASE FILE #${role.id}</span>
                <span class="text-xs text-gray-400 mt-1 uppercase tracking-widest">Confidential</span>
            `;
            return btn;
        }

        function createVoteButton(role) {
            const btn = document.createElement('button');
            btn.className = 'vote-btn bg-gray-800 text-white p-4 rounded-xl font-bold flex flex-col items-center justify-center h-32 border-2 border-gray-700';
            btn.innerHTML = `
                <span class="text-3xl mb-1">${role.icon}</span>
                <span class="text-xs uppercase text-center">#${role.id} ${role.title}</span>
            `;
            btn.onclick = function() {
                if (this.classList.contains('sus')) {
                    this.classList.remove('sus');
                    this.classList.add('ejected');
                } else if (this.classList.contains('ejected')) {
                    this.classList.remove('ejected');
                } else {
                    this.classList.add('sus');
                }
            };
            return btn;
        }

        function openRoleModal(role) {
            const modal = document.getElementById('role-modal');
            const content = document.getElementById('modal-content');
            
            content.innerHTML = `
                <div class="w-24 h-24 bg-gray-100 rounded-full flex items-center justify-center text-6xl mx-auto mb-6 shadow-inner border border-gray-300">
                    ${role.icon}
                </div>
                <h3 class="text-3xl font-black text-dark mb-2 font-mono uppercase">${role.title}</h3>
                <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 text-left my-6">
                    <p class="text-xs text-yellow-600 font-bold uppercase mb-1">Your Starting Phrase (Direct Speech)</p>
                    <p class="font-serif italic text-xl text-gray-800">${role.start}</p>
                </div>
                <div class="text-left bg-gray-800 p-4 rounded-lg text-white">
                    <p class="text-xs text-gray-400 font-bold uppercase mb-1">Status Report</p>
                    <p class="text-sm leading-relaxed">${role.secret}</p>
                </div>
            `;
            modal.classList.remove('hidden');
        }

        function closeRoleModal() {
            document.getElementById('role-modal').classList.add('hidden');
        }

        // --- Textbook Pop-out Logic ---
        function openTextbookModal() {
            const modal = document.getElementById('textbook-modal');
            const exercisesSource = document.getElementById('textbook-exercises-panel');
            const exercisesDest = document.getElementById('modal-exercises-container');
            exercisesDest.innerHTML = exercisesSource.innerHTML;
            modal.classList.remove('hidden');
        }

        function closeTextbookModal() {
            document.getElementById('textbook-modal').classList.add('hidden');
        }

        // --- Data Definitions ---
        const reportingVerbGroups = {
            "Verb + Infinitive": [
                { verb: 'agree', func: 'Agreeing', pattern: 'Verb + to + infinitive', rules: { pattern: 'Verb + to + Infinitive', example: 'Tesla **agreed to share** his patents.', thatExample: 'Tesla **agreed that** he would share his patents.' } },
                { verb: 'promise', func: 'Promising', pattern: 'Verb + to + infinitive', rules: { pattern: 'Verb + to + Infinitive', example: 'Westinghouse **promised to pay** the royalties.', thatExample: 'He **promised that** he would pay the royalties.' } },
                { verb: 'threaten', func: 'Threatening', pattern: 'Verb + to + infinitive', rules: { pattern: 'Verb + to + Infinitive', example: 'Edison **threatened to discredit** AC power.', thatExample: 'He **threatened that** he would discredit AC power.' } },
                { verb: 'refuse', func: 'Refusing', pattern: 'Verb + to + infinitive', rules: { pattern: 'Verb + to + Infinitive', example: 'Tesla **refused to accept** the Nobel Prize.', thatExample: 'He stated **that** he refused to accept it.' } }
            ],
            "Verb + Object + Infinitive": [
                { verb: 'advise', func: 'Advising', pattern: 'Verb + Object + to + infinitive', rules: { pattern: 'Verb + Obj + to + Inf', example: 'They **advised Tesla to ignore** the attacks.', thatExample: 'They **advised that** Tesla should ignore the attacks.' } },
                { verb: 'remind', func: 'Reminding', pattern: 'Verb + Object + to + infinitive', rules: { pattern: 'Verb + Obj + to + Inf', example: 'His assistant **reminded him to attend** the meeting.', thatExample: 'He **reminded him that** he needed to attend.' } },
                { verb: 'warn', func: 'Warning', pattern: 'Verb + Object + to + infinitive', rules: { pattern: 'Verb + Obj + to + Inf', example: 'Edison **warned the public to avoid** AC wires.', thatExample: 'Edison **warned that** AC wires were dangerous.' } },
                { verb: 'encourage', func: 'Encouraging', pattern: 'Verb + Object + to + infinitive', rules: { pattern: 'Verb + Obj + to + Inf', example: 'Investors **encouraged him to continue** his work.', thatExample: 'They **encouraged the idea that** he continue.' } }
            ],
            "Verb + Gerund (-ing)": [
                { verb: 'admit', func: 'Admitting', pattern: 'Verb + -ing', rules: { pattern: 'Verb + -ing', example: 'The company **admitted losing** the contract.', thatExample: 'The company **admitted that** they lost the contract.' } },
                { verb: 'deny', func: 'Denying', pattern: 'Verb + -ing', rules: { pattern: 'Verb + -ing', example: 'Edison **denied misleading** the public.', thatExample: 'Edison **denied that** he misled the public.' } },
                { verb: 'suggest', func: 'Suggesting', pattern: 'Verb + -ing', rules: { pattern: 'Verb + -ing', example: 'Tesla **suggested using** waterfalls for power.', thatExample: 'Tesla **suggested that** they use waterfalls.' } },
                { verb: 'recommend', func: 'Recommending', pattern: 'Verb + -ing', rules: { pattern: 'Verb + -ing', example: 'Experts **recommended switching** to AC.', thatExample: 'Experts **recommended that** they switch to AC.' } },
                { verb: 'regret', func: 'Regretting', pattern: 'Verb + -ing', rules: { pattern: 'Verb + -ing', example: 'He **regretted selling** his patents so early.', thatExample: 'He **regretted that** he sold his patents.' } }
            ],
            "Verb + Preposition": [
                { verb: 'apologize', func: 'Apologizing', pattern: 'Apologize + for + -ing', rules: { pattern: 'Verb + for + -ing', example: 'He **apologized for being** late.', thatExample: 'He **said he was sorry that** he was late.' } },
                { verb: 'insist', func: 'Insisting', pattern: 'Insist + on + -ing', rules: { pattern: 'Verb + on + -ing', example: 'Tesla **insisted on testing** the motor again.', thatExample: 'Tesla **insisted that** he test the motor again.' } }
            ]
        };

        const allVerbs = Object.values(reportingVerbGroups).flat();
        
        // --- Verb Detective Data ---
        const verbDetectiveData = [
            { quote: "Okay, I will share the patent with you.", intention: "Agreeing", verb: "agreed", reported: "He **agreed** to share the patent." },
            { quote: "I give you my word, I will pay the full amount.", intention: "Promising", verb: "promised", reported: "He **promised** to pay the full amount." },
            { quote: "If you don't stop, I will destroy your reputation!", intention: "Threatening", verb: "threatened", reported: "He **threatened** to destroy his reputation." },
            { quote: "No! I absolutely will not accept the prize.", intention: "Refusing", verb: "refused", reported: "He **refused** to accept the prize." },
            { quote: "You really should ignore those attacks, Tesla.", intention: "Advising", verb: "advised", reported: "He **advised** Tesla to ignore the attacks." },
            { quote: "Don't forget to attend the meeting tomorrow.", intention: "Reminding", verb: "reminded", reported: "He **reminded** him to attend the meeting." },
            { quote: "Don't touch those live wires! They are dangerous!", intention: "Warning", verb: "warned", reported: "He **warned** them not to touch the live wires." },
            { quote: "Go on, continue your work. You're doing great.", intention: "Encouraging", verb: "encouraged", reported: "He **encouraged** him to continue his work." },
            { quote: "Yes, it's true. We lost the contract.", intention: "Admitting", verb: "admitted", reported: "He **admitted** losing the contract." },
            { quote: "I did not mislead the public! That's a lie!", intention: "Denying", verb: "denied", reported: "He **denied** misleading the public." },
            { quote: "Why don't we use Niagara Falls for power?", intention: "Suggesting", verb: "suggested", reported: "He **suggested** using Niagara Falls for power." },
            { quote: "It would be best to switch to AC power now.", intention: "Recommending", verb: "recommended", reported: "He **recommended** switching to AC power." },
            { quote: "I wish I hadn't sold my patents so early.", intention: "Regretting", verb: "regretted", reported: "He **regretted** selling his patents so early." },
            { quote: "I am very sorry for being late.", intention: "Apologizing", verb: "apologized", reported: "He **apologized** for being late." },
            { quote: "I really must test the motor one more time.", intention: "Insisting", verb: "insisted", reported: "He **insisted** on testing the motor again." }
        ];

        // --- Suspect Cards Data ---
        const crimeRoles = [
            { id: 1, title: "The Chef", icon: "üë©‚Äçüç≥", start: "'I've been slaving over a hot stove in the kitchen...'", secret: "You are innocent. You were baking a cake." },
            { id: 2, title: "The Pianist", icon: "üéπ", start: "'I was right there on stage in the main hall...'", secret: "You are innocent. You were performing for guests." },
            { id: 3, title: "The Swimmer", icon: "üèä", start: "'Can't you see I'm soaking wet? I just got out...'", secret: "You are innocent. You were in the pool." },
            { id: 4, title: "The Gardener", icon: "üåø", start: "'I've been working in the mud by the flowerbeds...'", secret: "GUILTY! You entered through the garden window." },
            { id: 5, title: "The Guard", icon: "üëÆ", start: "'I was standing at the front door the whole time...'", secret: "You are innocent. You were guarding the front." },
            { id: 6, title: "The Artist", icon: "üé®", start: "'I was upstairs painting a portrait. Look at the paint...'", secret: "You are innocent. You were painting upstairs." },
            { id: 7, title: "The Gamer", icon: "üéÆ", start: "'I was in the basement beating my high score...'", secret: "You are innocent. You were gaming in the basement." },
            { id: 8, title: "The Doctor", icon: "ü©∫", start: "'I was attending to a guest who fainted in the library...'", secret: "You are innocent. You were helping a guest." },
            { id: 9, title: "The Biker", icon: "üèçÔ∏è", start: "'I just got here on my bike. I haven't even taken my leather gloves off...'", secret: "GUILTY! You wore gloves to avoid fingerprints." },
            { id: 10, title: "The Dancer", icon: "üíÉ", start: "'I haven't left the dance floor for hours...'", secret: "You are innocent. You were dancing." },
            { id: 11, title: "The Photographer", icon: "üì∏", start: "'I was busy taking photos of the cake...'", secret: "You are innocent. You were taking photos." },
            { id: 12, title: "The Dog Walker", icon: "üê∂", start: "'I was walking the dog down the street...'", secret: "You are innocent. You were outside walking the dog." }
        ];

        // --- Drills Data ---
        const quizData = [
            { q: "Direct: 'I didn't steal the money!' (<b>Deny</b>)", options: ["He denied to steal the money.", "He denied stealing the money.", "He denied steal the money."], a: 1 },
            { q: "Direct: 'Let's meet at the cafe.' (<b>Suggest</b>)", options: ["She suggested meeting at the cafe.", "She suggested to meet at the cafe.", "She suggested meet at the cafe."], a: 0 },
            { q: "Direct: 'I will definitely help you.' (<b>Promise</b>)", options: ["He promised helping me.", "He promised help me.", "He promised to help me."], a: 2 },
            { q: "Direct: 'You should see a doctor.' (<b>Advise</b>)", options: ["She advised me seeing a doctor.", "She advised me to see a doctor.", "She advised to see a doctor."], a: 1 },
            { q: "Direct: 'Don't forget to call mom.' (<b>Remind</b>)", options: ["He reminded me calling mom.", "He reminded to call mom.", "He reminded me to call mom."], a: 2 },
            { q: "Direct: 'I won't do it!' (<b>Refuse</b>)", options: ["She refused doing it.", "She refused to do it.", "She refused that she do it."], a: 1 },
            { q: "Direct: 'I'm sorry I was late.' (<b>Apologize</b>)", options: ["He apologized for being late.", "He apologized to be late.", "He apologized being late."], a: 0 },
            { q: "Direct: 'Please, please let me go.' (<b>Beg</b>)", options: ["He begged letting him go.", "He begged to let him go.", "He begged for let him go."], a: 1 }
        ];

        const prepData = [
            { q: "Insist", a: "ON" },
            { q: "Apologize", a: "FOR" },
            { q: "Accuse (someone)", a: "OF" },
            { q: "Congratulate (someone)", a: "ON" },
            { q: "Blame (someone)", a: "FOR" },
            { q: "Warn (someone)", a: "ABOUT" },
            { q: "Complain", a: "ABOUT" },
            { q: "Object", a: "TO" }
        ];

        // --- DOM Generation & Logic ---
        function renderVerbGroups() {
            const container = document.getElementById('verb-groups-container');
            container.innerHTML = '';
            for (const [groupName, verbs] of Object.entries(reportingVerbGroups)) {
                const header = document.createElement('div');
                header.innerHTML = `<h3 class="text-xl font-bold text-gray-400 uppercase tracking-widest border-b border-gray-200 pb-2 mb-6 flex items-center gap-2"><span class="w-2 h-2 rounded-full bg-primary"></span>${groupName}</h3>`;
                container.appendChild(header);
                const grid = document.createElement('div');
                grid.className = 'grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-12';
                verbs.forEach(verb => grid.appendChild(createVerbCard(verb)));
                container.appendChild(grid);
            }
        }
        
        function renderDetectiveGame() {
            const container = document.getElementById('detective-container');
            container.innerHTML = '';
            verbDetectiveData.forEach(item => container.appendChild(createDetectiveCard(item)));
        }

        function renderSuspects() {
            const listContainer = document.getElementById('suspects-list');
            const votingContainer = document.getElementById('voting-grid');
            
            listContainer.innerHTML = '';
            votingContainer.innerHTML = '';
            
            crimeRoles.forEach(role => {
                listContainer.appendChild(createSuspectFile(role));
                votingContainer.appendChild(createVoteButton(role));
            });
        }

        // --- Drills Logic ---
        function loadNewQuizQuestion() {
            const container = document.getElementById('quiz-container');
            const q = quizData[Math.floor(Math.random() * quizData.length)];
            container.innerHTML = `
                <div class="text-lg font-mono text-gray-700 mb-4 bg-gray-50 p-3 rounded border-l-4 border-indigo-500">${q.q}</div>
                <div class="space-y-2">
                    ${q.options.map((opt, i) => `<button onclick="checkQuiz(this, ${i === q.a})" class="drill-btn w-full text-left p-3 rounded border border-gray-200 hover:bg-gray-50 text-sm font-medium text-gray-600">${opt}</button>`).join('')}
                </div>
            `;
        }

        function checkQuiz(btn, isCorrect) {
            if (isCorrect) {
                btn.classList.add('correct');
                btn.innerHTML += ' ‚úÖ';
            } else {
                btn.classList.add('incorrect');
                btn.innerHTML += ' ‚ùå';
            }
        }

        function loadPrepositionDrill() {
            const qObj = prepData[Math.floor(Math.random() * prepData.length)];
            document.getElementById('prep-question').textContent = `"${qObj.q}..."`;
            
            // Generate distinct options including the correct one
            let options = ["ON", "FOR", "OF", "TO", "ABOUT", "WITH"];
            // Ensure correct answer is present
            if (!options.includes(qObj.a)) options.push(qObj.a);
            
            // Randomly select 3 distractors + correct answer
            let displayedOptions = [qObj.a];
            while (displayedOptions.length < 4) {
                const randomOpt = options[Math.floor(Math.random() * options.length)];
                if (!displayedOptions.includes(randomOpt)) displayedOptions.push(randomOpt);
            }
            displayedOptions.sort(() => 0.5 - Math.random()); // Shuffle
            
            const container = document.getElementById('prep-options');
            container.innerHTML = displayedOptions.map(opt => `<button onclick="checkPrep(this, '${opt}', '${qObj.a}')" class="drill-btn w-full p-4 text-lg rounded border border-gray-200 hover:bg-yellow-50 text-gray-600 font-bold">${opt}</button>`).join('');
            document.getElementById('prep-feedback').textContent = '';
        }

        function checkPrep(btn, selected, correct) {
            if (selected === correct) {
                btn.classList.add('correct');
                document.getElementById('prep-feedback').innerHTML = '<span class="text-green-500">Correct!</span>';
                setTimeout(loadPrepositionDrill, 1000);
            } else {
                btn.classList.add('incorrect');
                document.getElementById('prep-feedback').innerHTML = '<span class="text-red-500">Try again!</span>';
            }
        }

        // --- App Initialization & Event Listeners ---
        document.addEventListener('DOMContentLoaded', () => {
            renderVerbGroups();
            renderDetectiveGame();
            renderSuspects();
            loadNewQuizQuestion();
            loadPrepositionDrill();

            const generateBtn = document.getElementById('generate-scenario-btn');
            const scenarioBox = document.getElementById('scenario-box');
            const scenarioText = document.getElementById('scenario-text');
            const directQuoteText = document.getElementById('direct-quote-text');
            const speakerText = document.getElementById('speaker-text');
            const userInput = document.getElementById('user-input');
            const checkBtn = document.getElementById('check-sentence-btn');
            const feedbackBox = document.getElementById('feedback-box');
            const feedbackText = document.getElementById('feedback-text');
            const verdictTitle = document.getElementById('verdict-title');
            const correctAnswerText = document.getElementById('correct-answer-text');
            
            generateBtn.addEventListener('click', () => {
                scenarioBox.classList.remove('hidden');
                // Pick random scenario
                currentScenario = offlineScenarios[Math.floor(Math.random() * offlineScenarios.length)];
                
                scenarioText.innerHTML = `Report this quote using <span class="text-primary font-bold">"${currentScenario.verb}"</span>.`;
                directQuoteText.textContent = `"${currentScenario.quote}"`;
                speakerText.textContent = `- ${currentScenario.speaker}`;
                userInput.value = '';
                feedbackBox.classList.add('hidden');
                setTimeout(() => scenarioBox.scrollIntoView({ behavior: 'smooth', block: 'center' }), 100);
            });

            checkBtn.addEventListener('click', () => {
                const userSentence = userInput.value.trim();
                if (!userSentence) return;
                
                feedbackBox.classList.remove('hidden');
                
                // Simple feedback logic for offline mode
                verdictTitle.innerHTML = 'Review Time üßê';
                feedbackText.innerHTML = "Compare your answer with the suggested correct version below. Did you use the correct verb pattern?";
                correctAnswerText.textContent = currentScenario.answer;
            });
        });
    </script>
</body>
</html>
